package test;

import static org.junit.jupiter.api.Assertions.assertTrue;
import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.junit.jupiter.api.Assertions;

import org.junit.jupiter.api.Test;
import org.mockito.Mockito;


public class UnitTesting {
	
	@Test
	public void testSendEmail() {
		EmailService es=mock(EmailService.class);
		user u=new user(es);
		
		String email="test@test.com";
		String subject="Test Subject";
		String body="Test Body";
		
		u.sendEmail(email,subject,body);
		
		verify(es, times(1)).sendEmail(email, subject, body);
		
	}
	
	@Test 
	public void testValidEmail() {
		assertTrue(isValidEmail("test@test.com"));
		assertTrue(isValidEmail("test-example@gmail.com"));
		assertTrue(isValidEmail("test.example@test.example.co"));
	}
	
	@Test
	public void testInvalidEmail() {
		assertFalse(isValidEmail(".test@test.com"));
		assertFalse(isValidEmail("testgmail.com"));
		assertFalse(isValidEmail("test@.com"));
	}
	
	private boolean isValidEmail(String email) {
		String regex="^(?=.{1,64}@)[A-Za-z0-9_-]+(\\\\.[A-Za-z0-9_-]+)*@[^-][A-Za-z0-9-]+(\\\\.[A-Za-z0-9-]+)*(\\\\.[A-Za-z]{2,})$";
		Pattern p=Pattern.compile(regex);
		Matcher m=p.matcher(email);
		return m.matches();
	}
	
	@Test
	public void testPasswordLength() {
		assertTrue(isValidLength("123456"));
		assertTrue(isValidLength("12345678901234567890"));
		assertFalse(isValidLength("12345"));
		assertTrue(isValidLength("123456789012345678901"));
	}
	
	private boolean isValidLength(String pwd) {
		return pwd.length()>=6 && pwd.length()<=20;
	}
	

}
